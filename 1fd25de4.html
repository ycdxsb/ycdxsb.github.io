<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpeg"><link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpeg"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.ycdxsb.cn",root:"/",scheme:"Pisces",version:"7.7.2",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!0,nav:null,activeClass:"valine"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="¶基础知识¶栈溢出与ROP栈溢出指的是程序向栈中某个变量中写入的字节数超过了这个变量本身所申请的字节数，因而导致与其相邻的栈中的变量的值被改变。栈溢出漏洞就是由于栈溢出而导致的漏洞。在程序执行过程中，常使用栈帧记录程序执行过程中的状态，在栈帧中保存着返回地址，当利用栈溢出漏洞修改函数返回地址跳转到非预期地址执行时，就产生了ROP攻击，又称返回导向编程。"><meta property="og:type" content="article"><meta property="og:title" content="栈溢出与ROP分析与利用"><meta property="og:url" content="https://blog.ycdxsb.cn/1fd25de4.html"><meta property="og:site_name" content="食兔人的博客"><meta property="og:description" content="¶基础知识¶栈溢出与ROP栈溢出指的是程序向栈中某个变量中写入的字节数超过了这个变量本身所申请的字节数，因而导致与其相邻的栈中的变量的值被改变。栈溢出漏洞就是由于栈溢出而导致的漏洞。在程序执行过程中，常使用栈帧记录程序执行过程中的状态，在栈帧中保存着返回地址，当利用栈溢出漏洞修改函数返回地址跳转到非预期地址执行时，就产生了ROP攻击，又称返回导向编程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0ymqmgj31820b2myd.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n1079wjj30vu0cyaki.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n13eoemj30k40eet9h.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n13umjmj30n008s758.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0qb7u9j30vy0didhe.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n113om5j30s60f2wg5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0s4ub1j30ts0akdil.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0smec9j30z20g6qa4.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0rp24xj317002wgmh.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0pxfjcj30ou0nuach.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0wr67uj30l6084jub.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0z49fqj30va0emtaa.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0og4q1j30uy0aymy8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0qrlt8j30pu0e8wg6.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0tzt4bj30me08a3zh.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0xpvrrj30ww0dmgn6.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0x8vxej30o60583z1.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0wb4opj30xm0ikgnf.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0vvu6nj30mw092my4.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n11kl93j30xy0bm75h.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n12xaf9j30vc0bimyg.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0n76hqj30qo08sjsd.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n12haa2j30ug0b4tcm.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0ny3jaj313y05smxz.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0tb3tyj30pe08uwfh.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0uyia6j30xe0cimyn.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0y6mfmj30v40bsdh1.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0vfc0mj30te0c03zr.jpg"><meta property="article:published_time" content="2020-04-22T19:47:00.000Z"><meta property="article:modified_time" content="2020-04-22T12:12:46.046Z"><meta property="article:author" content="食兔人"><meta property="article:tag" content="CTF"><meta property="article:tag" content="pwn"><meta property="article:tag" content="stack overflow"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0ymqmgj31820b2myd.jpg"><link rel="canonical" href="https://blog.ycdxsb.cn/1fd25de4.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>栈溢出与ROP分析与利用 | 食兔人的博客</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">食兔人的博客</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/ycdxsb" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.ycdxsb.cn/1fd25de4.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpeg"><meta itemprop="name" content="食兔人"><meta itemprop="description" content="About My Life and Study"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="食兔人的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">栈溢出与ROP分析与利用</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-04-22 19:47:00 / 修改时间：12:12:46" itemprop="dateCreated datePublished" datetime="2020-04-22T19:47:00+00:00">2020-04-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CTF/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CTF/pwn/stack-overflow/" itemprop="url" rel="index"><span itemprop="name">stack_overflow</span></a> </span></span><span id="/1fd25de4.html" class="post-meta-item leancloud_visitors" data-flag-title="栈溢出与ROP分析与利用" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/1fd25de4.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/1fd25de4.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.6k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2><span id="pji-chu-zhi-shi">基础知识</span><a href="#pji-chu-zhi-shi" class="header-anchor">#</a></h2><h3><span id="pzhan-yi-chu-yu-rop">栈溢出与ROP</span><a href="#pzhan-yi-chu-yu-rop" class="header-anchor">#</a></h3><p>栈溢出指的是程序向栈中某个变量中写入的字节数超过了这个变量本身所申请的字节数，因而导致与其相邻的栈中的变量的值被改变。栈溢出漏洞就是由于栈溢出而导致的漏洞。在程序执行过程中，常使用栈帧记录程序执行过程中的状态，在栈帧中保存着返回地址，当利用栈溢出漏洞修改函数返回地址跳转到非预期地址执行时，就产生了ROP攻击，又称返回导向编程。</p><a id="more"></a><h3><span id="pcheng-xu-diao-yong-zhan">程序调用栈</span><a href="#pcheng-xu-diao-yong-zhan" class="header-anchor">#</a></h3><p>栈帧是记录程序执行过程中状态的结构。在cdecl调用约定中，当程序P调用Q时，会出现以下行为：</p><ol><li>P将Q需要的参数保存到栈或者约定寄存器中，再将Q的返回地址存入栈；</li><li>Q在栈中保存当前esp/rsp寄存器中的值，再将ebp/rbp寄存器中值赋值给esp/rsp寄存器形成栈帧；</li><li>Q申请的局部变量需要的栈空间；</li><li>当Q执行完毕，使用栈中保存的esp/rsp值恢复给esp/rsp寄存器；</li><li>从栈中取出返回地址，跳转回P中继续执行；</li></ol><p>正是因为存在程序调用栈，当出现栈溢出漏洞时，我们能够对返回地址进行劫持，修改程序默认执行路径，达到自己的目的。</p><h2><span id="pchang-jian-bao-hu-ji-zhi">常见保护机制</span><a href="#pchang-jian-bao-hu-ji-zhi" class="header-anchor">#</a></h2><p>在栈溢出漏洞攻防博弈中，程序的保护机制十分重要。对白客来说，通过添加程序保护机制，能够提高漏洞利用的门槛，一定程度上防止程序漏洞被利用；而对于黑客来说，熟悉程序保护机制，能够在漏洞利用过程中少走弯路，提高漏洞利用的效率。</p><p>图2.1所示是使用checksec工具检查linux系统中sh二进制文件的结果。可以看到它启用了RELRO、Canary、NX、PIE和FORTIFY保护。其中Canary、NX和PIE这三种在实际利用中较为常见且有用。其中Canary 和NX在Windows系统中也有类似的保护机制。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0ymqmgj31820b2myd.jpg" alt="img"></p><center>图2.1 linux下sh中存在的保护机制</center><h3><span id="pnx-yu-dep">NX与DEP</span><a href="#pnx-yu-dep" class="header-anchor">#</a></h3><p>NX是No eXcute的缩写，意为不可执行保护，在Windows系统中为DEP保护。其根本原理如图2.2所示，黑客需要利用漏洞劫持返回地址到某个位置执行，而这一保护将区域置为不可执行，当跳转到该区域内时，检测到异常，触发异常处理并退出程序，使得劫持失效。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n1079wjj30vu0cyaki.jpg" alt="img"></p><center>图2.2 NX/DEP原理</center><h3><span id="pcanary-yu-gs">Canary与GS</span><a href="#pcanary-yu-gs" class="header-anchor">#</a></h3><p>Linux下的Canary保护对应Windows下的GS保护。利用栈溢出是线性连续的覆盖栈内的数据这一特性，在返回地址前插入一个随机的不可预测值，并在函数返回时检查是否被修改，如果被修改，则一定产生了栈溢出，此时会退出程序执行。如图2.3所示，是x86下的Canary保护时栈内布局示意图。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n13eoemj30k40eet9h.jpg" alt="img"></p><center>图2.3 Canary/GS保护栈布局图</center><h3><span id="ppie-yu-aslr">PIE与ASLR</span><a href="#ppie-yu-aslr" class="header-anchor">#</a></h3><p>PIE是编译过程中的选项，是位置独立的可执行区域的意思。当操作系统开启ASLR（内存地址随机化）时，会打乱二进制文件加载的基址，使得返回地址随机，即使动态调试中EXP通过，但远程攻击时也会由于地址随机化机制失效。操作系统中ASLR存在3个可选项，如下：</p><ul><li>值为0：无随机化，堆栈地址每次都相同</li><li>值为1：随机化出了堆基址以外的所有加载基址</li><li>值为2：随机化所有加载基址（包括堆）</li></ul><h2><span id="prop-fen-xi-yu-li-yong">ROP分析与利用</span><a href="#prop-fen-xi-yu-li-yong" class="header-anchor">#</a></h2><p>ROP，又称返回导向编程，利用程序指令集中存在的ret指令，改变指令流的执行顺序。其利用条件为：</p><ol><li>程序存在溢出且能够控制返回地址；</li><li>可以找到满足条件的gadgets和gadgets地址。</li></ol><p>基本的分类如下：ret2text、ret2shellcode、ret2syscall、ret2libc。</p><p>注：以下分析与利用都为32位程序，示例二进制文件来源于<a href="http://ctfwiki.ycdxsb.cn/pwn/linux/stackoverflow/basic-rop-zh/" target="_blank" rel="noopener">ctfwiki</a>。</p><h3><span id="pret2text">ret2text</span><a href="#pret2text" class="header-anchor">#</a></h3><p>ret2text是指返回到程序中text段已有的代码中执行。</p><p>分析与利用步骤： 以附件中的ret2text程序为例</p><ol><li>checksec查看保护结果如图3.1.1所示，能够看到没有开启保护。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n13umjmj30n008s758.jpg" alt="img"></p><center>图3.1.1 checksec查看ret2text结果</center><ol start="2"><li>使用IDA查看ret2text main函数如图3.1.2所示，能够看到存在栈溢出漏洞，由于gets函数未判断读入长度，能使用读入的字符串写入s覆盖到main函数返回地址。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0qb7u9j30vy0didhe.jpg" alt="img"></p><center>图3.1.2 ret2text main函数</center><ol start="3"><li>在secure函数中寻找到system(“/bin/sh”)，如图3.1.3</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n113om5j30s60f2wg5.jpg" alt="img"></p><center>图3.1.3 secure函数</center><ol start="4"><li>通过输入对栈进行布局。由于未开启保护，我们能直接找到调用system(“/bin/sh”)的指令地址system_binsh_addr，因此我们通过栈溢出布置栈布局如图3.1.4所示，栈溢出首先需要覆盖旧的ebp值，进而覆盖到返回地址，将其修改为system_binsh_addr的地址即可。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0s4ub1j30ts0akdil.jpg" alt="img"></p><center>图3.1.4 ret2text栈布局</center><ol start="5"><li>最后我们需要确定填入的padding长度，使得正好溢出到我们需要的位置，通过gdb和其插件动态调试可以获得，如图3.1.5调试信息可知，padding长度为108。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0smec9j30z20g6qa4.jpg" alt="img"></p><center>图3.1.5 gdb调试padding长度</center><ol start="6"><li>确定输入，由以上信息我们就能构造最后的输入，为108*’A’+p32(0xdeadbeaf)+p32(system_binsh_addr)。</li></ol><h3><span id="pret2shellcode">ret2shellcode</span><a href="#pret2shellcode" class="header-anchor">#</a></h3><p>shellcode是能让黑客获得shell的16进制机器码，当text段没有能获取shell的代码时，就需要我们自己想办法将shellcode放入内存中了。各种条件下的shellcode可以参考<a href="http://shell-storm.org/shellcode/" target="_blank" rel="noopener">shellstorm</a>获得。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0rp24xj317002wgmh.jpg" alt="img"></p><center>图3.2.1 16进制shellcode</center><p>图3.2.1是一段16进制shellcode，对应的汇编代码如图3.2.2 所示。可以看到是将字符串/bin/sh\x00存入，再通过系统调用好获取shell。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0pxfjcj30ou0nuach.jpg" alt="img"></p><center>图3.2.2 shellcode汇编代码</center><p>分析与利用步骤：以附件中的ret2shellcode文件为例</p><ol><li>checksec查看程序保护机制，如图3.2.3所示，没有开启。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0wr67uj30l6084jub.jpg" alt="img"></p><center>图3.2.3 ret2shellcode 保护机制</center><ol start="2"><li>使用IDA查看main函数如图3.2.4所示，可以看到gets存在栈溢出问题，并且将s内容放到了.bss段的buf2内。由于.bss段具有可执行权限，所以我们可以将shellcode输入存在buf2中，再修改返回地址到buf2处执行。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0z49fqj30va0emtaa.jpg" alt="img"></p><center>图3.2.4 ret2shellcode main函数</center><ol start="3"><li>通过输入对栈布局如图3.2.5所示，由于存在拷贝，会将shellcode拷贝到buf2，再跳转到buf2执行shellcode即可。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0og4q1j30uy0aymy8.jpg" alt="img"></p><center>图3.2.5 ret2shellcode栈布局</center><ol start="4"><li><p>同ret2text一样确定padding长度为108。</p></li><li><p>构造输入为shellcode+(108-len(shellcode))+p32(0xdeadbeaf)+p32(buf2)即可。</p></li></ol><h3><span id="pret2syscall">ret2syscall</span><a href="#pret2syscall" class="header-anchor">#</a></h3><p>ret2syscall是指返回到系统调用执行。例如执行execve(‘/bin/sh’,0,0)获取shell。通过系统调用号，来调用系统函数，不使用libc中的函数，更加底层。在利用过程中，首先通过栈溢出和gadgets将寄存器置为需要的值，再使用int 0x80进行系统调用。</p><p>图3.3.1所示是execve(‘/bin/sh‘,0,0)对应汇编代码。可以看到从栈中取出了参数放入对应的寄存器，寄存器edx置0，ecx置0，ebx置为’/bin/sh’地址，在eax中存入系统调用号0xb。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0qrlt8j30pu0e8wg6.jpg" alt="img"></p><center>图3.3.1 execve获取shell的汇编代码</center><p>分析与利用步骤：以附件中的retsyscall程序为例</p><ol><li>checksec查看保护如图3.3.2 所示，未开启保护。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0tzt4bj30me08a3zh.jpg" alt="img"></p><center>图3.3.2 ret2syscall保护机制</center><ol start="2"><li>IDA打开查看main函数如图3.3.3所示，存在栈溢出。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0xpvrrj30ww0dmgn6.jpg" alt="img"></p><center>图3.3.3 ret2syscall main函数</center><ol start="3"><li>通过ROPgadgets工具能找到修改寄存器值，int 0x80，/bin/sh的gadgets地址如图3.3.4所示。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0x8vxej30o60583z1.jpg" alt="img"></p><center>图3.3.4 ret2syscall gadgets</center><ol start="4"><li>通过gadgets和栈溢出，就能构造栈布局进行利用了，如图3.3.5所示。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0wb4opj30xm0ikgnf.jpg" alt="img"></p><center>图3.3.5 ret2syscall 栈布局</center><p>当函数返回时，首先会利用两个pop的gadgets及栈中数据，修改eax、ebx、ecx、edx寄存器的值，最后执行int 0x80，就能获得shell了。</p><ol start="5"><li>padding长度依旧为108，构造输入为</li></ol><p>108*’A’+p32(0xdeadbeaf)+p32(pop_eax_ret)+p32(0xb)+p32(pop_edx_ecx_ebx_ret)+p32(0)+p32(0)+p32(binsh_address)+p32(int_0x80_addr)即可。</p><h3><span id="pret2libc">ret2libc</span><a href="#pret2libc" class="header-anchor">#</a></h3><p>ret2libc 即控制函数的执行 libc 中的函数，通常是返回至某个函数的 plt 处或者函数的具体位置 (即函数对应的 got 表项的内容)。一般情况下，会选择执行 system(&quot;/bin/sh&quot;)，故而需要知道 system 函数的地址。可以分为以下三种情况：</p><ul><li>类型1：有”/bin/sh”，有system函数</li><li>类型2：没有”/bin/sh”，有system函数</li><li>类型3：没有”/bin/sh”，没有system函数</li></ul><h4><span id="plei-xing-1-you-bin-sh-you-system-han-shu">类型1：有”/bin/sh”，有system函数</span><a href="#plei-xing-1-you-bin-sh-you-system-han-shu" class="header-anchor">#</a></h4><p>分析与利用步骤：以附件中的ret2libc1文件为例</p><ol><li>checksec查看ret2libc1保护如图3.4.1所示，开启了NX保护。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0vvu6nj30mw092my4.jpg" alt="img"></p><center>图3.4.1 ret2libc1 保护机制</center><ol start="2"><li>IDA查看main函数，可以看到存在栈溢出漏洞，如图3.4.2所示。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n11kl93j30xy0bm75h.jpg" alt="img"></p><center>图3.4.2 ret2libc1 main函数</center><ol start="3"><li><p>使用ROPgadget工具，在程序中能够找到/bin/sh字符串地址binsh_address，且在程序的plt表中能够找到system函数地址system_plt_address，即为第一类。</p></li><li><p>通过栈溢出布局，由于我们知道字符串地址和system在plt表中地址，所以不需要泄露libc基址。如图3.4.3所示，覆盖返回地址为system_plt_address，并放入参数为/bin/sh地址即可。</p></li><li><p>同前，padding长度为108，构造输入为:</p></li></ol><p>’A’*108+p32(0xdeadbeaf)+p32(system_plt_address)+p32(0xdeadbeaf)+p32(binsh_address)</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n12xaf9j30vc0bimyg.jpg" alt="img"></p><center>图3.4.3 ret2libc1 栈布局</center><h4><span id="plei-xing-2-mei-you-bin-sh-you-system-han-shu">类型2：没有”/bin/sh”，有system函数</span><a href="#plei-xing-2-mei-you-bin-sh-you-system-han-shu" class="header-anchor">#</a></h4><p>分析与利用步骤：以附件中ret2libc2文件为例</p><ol><li>checksec查看保护机制，如图3.4.4所示，只开启了NX保护</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0n76hqj30qo08sjsd.jpg" alt="img"></p><center>图3.4.4 ret2libc2 保护机制</center><ol start="2"><li>IDA打开查看main函数，如图3.4.5所示，同样存在栈溢出漏洞。与ret2libc1不同的是，ret2libc2中不存在/bin/sh字符串，但是我们能在.bss段找到一个全局的buf2数组，长度为0x64。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n12haa2j30ug0b4tcm.jpg" alt="img"></p><center>图3.4.5 ret2libc2 main函数</center><ol start="3"><li><p>由于plt表中存在gets函数地址gets_plt和system函数地址system_plt，.bss段buf2数组地址为buf2_addr。因此利用可以分为两步，首先构造执行gets(buf2_addr)将/bin/sh字符串写入全局buf2中，再执行system(buf2_addr)达到目的。</p></li><li><p>经过上述分析，可以对栈布局如图3.4.6所示，在这里要注意，由于在程序执行中gets有一个参数，因此需要将其pop出去才能继续执行。</p></li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0ny3jaj313y05smxz.jpg" alt="img"></p><center>图3.4.6 ret2libc2 栈布局</center><ol start="5"><li>同样padding长度仍然为108，最后可以构造输入如下：</li></ol><p>108*’A’+p32(0xdeadbeaf)+p32(gets_plt)+p32(pop_ebx_ret)+p32(buf2_addr)+p32(system_plt)+p32(0xdeadbeaf)+p32(buf2_addr)</p><h4><span id="plei-xing-3-mei-you-bin-sh-mei-you-system-han-shu">类型3：没有”/bin/sh”，没有system函数</span><a href="#plei-xing-3-mei-you-bin-sh-mei-you-system-han-shu" class="header-anchor">#</a></h4><p>这一类的漏洞利用思路如下：</p><ul><li><p>system函数属于<code>libc.so</code>，在libc.so中的相对偏移是固定的</p></li><li><p>即使开启了ASRL保护，也不会改变加载地址的低12位</p></li><li><p>可以通过GOT表泄露已执行过的libc.so中的函数的地址</p></li><li><p>通过泄露的低12位找到libc.so版本，得到system函数和/bin/sh地址</p></li><li><p>ROP利用<br>分析与利用步骤：以附件中的ret2libc3文件为例</p></li></ul><p>1．checksec查看ret2libc3保护机制，如图3.4.7所示，只开启了NX保护</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0tb3tyj30pe08uwfh.jpg" alt="img"></p><center>图3.4.7 ret2libc3保护机制</center><ol start="2"><li>IDA打开查看main函数，如图3.4.8所示，存在栈溢出。存在gets和puts两个libc.so中的函数</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0uyia6j30xe0cimyn.jpg" alt="img"></p><center>图3.4.8 ret2libc3 main函数</center><ol start="3"><li>根据之前所说的利用思路，可以想到以下利用步骤：</li></ol><ul><li><p>第一次ROP：利用puts函数泄露__libc_start_main函数地址</p></li><li><p>通过低12位查找libc.so版本</p></li><li><p>得到实际的system函数和/bin/sh地址</p></li><li><p>第二次ROP：执行system(“/bin/sh”)</p></li></ul><p>这里我们需要让main函数执行两次，这样才能进行两次ROP</p><ol start="4"><li>第一次ROP栈布局如图3.4.9所示，返回时，先调用puts函数输出__libc_start_main函数地址，然后会进入第二次main函数的执行，得到了第二次ROP的机会</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0y6mfmj30v40bsdh1.jpg" alt="img"></p><center>图3.4.9 ret2libc3 第一次ROP栈布局</center><ol start="5"><li>通过泄露的__libc_start_main函数地址，可以得到system函数地址和/bin/sh地址，从而第二次ROP栈布局如图3.4.10所示，执行system(“/bin/sh”) 。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge2n0vfc0mj30te0c03zr.jpg" alt="img"></p><center>图3.4.10 ret2libc3 第二次ROP栈布局</center><p>在通过低12位查询libc.so版本时可以利用<a href="https://github.com/niklasb/libc-database" target="_blank" rel="noopener">libc版本数据库</a>， 以及其对于python的查询封装<a href="https://github.com/lieanu/LibcSearcher" target="_blank" rel="noopener">LibcSearcher</a>。</p></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/a4584c42.html" rel="bookmark">pwnable.kr —— random</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/ad24c8c9.html" rel="bookmark">ROP Emporium (上)</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/d7bb76ce.html" rel="bookmark">pwnable.kr —— asm</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/1c0d597c.html" rel="bookmark">pwnable.kr —— blackjack</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/df231074.html" rel="bookmark">pwnable.kr —— blukat</a></div></li></ul><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作!</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.jpeg" alt="食兔人 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.jpeg" alt="食兔人 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>ycdxsb</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://blog.ycdxsb.cn/1fd25de4.html" title="栈溢出与ROP分析与利用">https://blog.ycdxsb.cn/1fd25de4.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/CTF/" rel="tag"><i class="fa fa-tag"></i> CTF</a> <a href="/tags/pwn/" rel="tag"><i class="fa fa-tag"></i> pwn</a> <a href="/tags/stack-overflow/" rel="tag"><i class="fa fa-tag"></i> stack overflow</a></div><div class="post-nav"><div class="post-nav-item"><a href="/7160fe1c.html" rel="prev" title="Beyond Free Riding-Quality of Indicators for Assessing Participation in Information Sharing for Threat Intelligence"><i class="fa fa-chevron-left"></i> Beyond Free Riding-Quality of Indicators for Assessing Participation in Information Sharing for Threat Intelligence</a></div><div class="post-nav-item"></div></div></footer></article></div></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-number">1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">1.1.</span> <span class="nav-text">栈溢出与ROP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">1.2.</span> <span class="nav-text">程序调用栈</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-number">2.</span> <span class="nav-text">常见保护机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">2.1.</span> <span class="nav-text">NX与DEP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">2.2.</span> <span class="nav-text">Canary与GS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">2.3.</span> <span class="nav-text">PIE与ASLR</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-number">3.</span> <span class="nav-text">ROP分析与利用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">3.1.</span> <span class="nav-text">ret2text</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">3.2.</span> <span class="nav-text">ret2shellcode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">3.3.</span> <span class="nav-text">ret2syscall</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">3.4.</span> <span class="nav-text">ret2libc</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#"><span class="nav-number">3.4.1.</span> <span class="nav-text">类型1：有”&#x2F;bin&#x2F;sh”，有system函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#"><span class="nav-number">3.4.2.</span> <span class="nav-text">类型2：没有”&#x2F;bin&#x2F;sh”，有system函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#"><span class="nav-number">3.4.3.</span> <span class="nav-text">类型3：没有”&#x2F;bin&#x2F;sh”，没有system函数</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="食兔人" src="/images/avatar.jpeg"><p class="site-author-name" itemprop="name">食兔人</p><div class="site-description" itemprop="description">About My Life and Study</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">41</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ycdxsb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ycdxsb" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:1452740432@qq.com" title="E-Mail → mailto:1452740432@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/1fd25de4.html" title="栈溢出与ROP分析与利用" target="_blank">栈溢出与ROP分析与利用</a></li><li class="recent_posts_li"><a href="/7160fe1c.html" title="Beyond Free Riding-Quality of Indicators for Assessing Participation in Information Sharing for Threat Intelligence" target="_blank">Beyond Free Riding-Quality of Indicators for Assessing Participation in Information Sharing for Threat Intelligence</a></li><li class="recent_posts_li"><a href="/1ffe8215.html" title="An analysis and classification of public information securiy data sources used in research and practice" target="_blank">An analysis and classification of public information securiy data sources used in research and practice</a></li><li class="recent_posts_li"><a href="/62d14747.html" title="pwnable.kr —— horcruxes" target="_blank">pwnable.kr —— horcruxes</a></li><li class="recent_posts_li"><a href="/df231074.html" title="pwnable.kr —— blukat" target="_blank">pwnable.kr —— blukat</a></li></ul></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><span id="sitetime"></span><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2020,3,29,0,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML=" 已运行"+m+" 年 "+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备20009842号 </a><img src="/images/beian.png" style="display:inline-block"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33042402000302" rel="noopener" target="_blank">浙公网安备 33042402000302号</a></div><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">食兔人</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">160k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">2:25</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'arzLjs0uhdNidwVh9BC6XEl2-gzGzoHsz',
      appKey     : 'UTxl8VuzUJM8vVhRdRKuNIM6',
      placeholder: "ヾﾉ≧∀≦)o 来呀！快活呀！~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":200,"height":400},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>